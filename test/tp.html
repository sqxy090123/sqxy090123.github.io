<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>TP网页</title>
</head>
<body>
  <h1>欢迎访问TP网页</h1>
  <p>请输入要访问的网址：</p>
  <form>
    <input type="text" name="url" placeholder="https://example.com">
    <button type="submit">访问</button>
  </form>

  <script>
    const queryString = window.location.search;
    if (queryString) {
      const urlParams = new URLSearchParams(decodeURIComponent(queryString));
      let url = urlParams.get('url');
      
      // 如果 URL 没有 http 或 https 前缀，则自动添加 http 前缀
      if (!/^https?:\/\//i.test(url)) {
        url = `http://${url}`;
      }

      if (url) {
        const whitelist = [
          'baidu.com',
          'pan.baidu.com',
          'yun.baidu.com',
          'wangpan007.com',
          'wpan.org',
          'weiyun.com',
          'cloud.189.cn',
          'transfer.pcloud.com',
          'dropbox.com',
          'googledrive.com',
          'onedrive.live.com',
          'mega.nz',
          'downcc.com',
          'm.downcc.com',
          'sqxy090123.github.io',
          'github.com',
          'gitee.com',
          'gitee.io',
          'gitlab.com',
          'weixin.qq.com',
          'qq.com',
          'quark.com',
          'www.bilibili.com',
          'www.mi.com',
          'www.meizu.com.cn',
          'www.huawei.com',
          'www.oppo.com',
          'www.vivo.com',
          'www.samsung.com',
          'pan.quark.com',
          'dl.pconline.com.cn',
          'www.downza.cn',
          'www.gamersky.com',
          'game.ali213.net',
          'www.3dmgame.com',
          'www.xiaoyouxi88.com',
          'www.csol.com',
          'www.wanmei.com',
          'hmcl.net'
        ];
        const blacklist = [
          'freedirtygame.com',
          'acg fabu.com'
        ];
        // 判断 URL 是否在黑名单中
        const parsedUrl = new URL(url);
        if (blacklist.some(disallowedDomain => parsedUrl.hostname.endsWith(`.${disallowedDomain}`))) {
          // URL 在黑名单中，阻止跳转
          alert(`您即将访问的网站 ${url} 被列为非法网站，无法访问`);
          window.history.back(); // 返回上一级网址
        } else if (whitelist.some(allowedDomain => parsedUrl.hostname.endsWith(`.${allowedDomain}`))) {
          // URL 在白名单中，可以直接跳转
          window.location.href = url;
        } else {
          // URL 不在白名单中，弹出警告框
          const message = `您即将访问的网站 ${url} 可能存在风险，是否继续访问？`;
          if (confirm(message)) {
            window.location.href = url;
          } else {
            window.history.back(); // 返回上一级网址
          }
        }
      }
    }
  </script>
</body>
</html>
